<div class="export-app">
  <!-- Header -->
  <header class="app-header">
    <div class="header-left">
      <div class="accent-dot"></div>
      <h1 class="title">
        <span class="title-main">Export</span>
        <span class="title-sub">Jobs & Scheduling</span>
      </h1>
    </div>
    <div class="header-right">
      <div class="view-toggle">
        <button
          class="view-btn"
          [class.active]="viewMode() === 'jobs'"
          (click)="setViewMode('jobs')"
        >
          Jobs
        </button>
        <button
          class="view-btn"
          [class.active]="viewMode() === 'schedule'"
          (click)="setViewMode('schedule')"
        >
          Schedule
        </button>
      </div>
      <div class="header-divider"></div>
      <ui-action-button variant="primary" (clicked)="onNewExport()">
        + New Export
      </ui-action-button>
      <ui-theme-toggle />
    </div>
  </header>

  <!-- Main Content -->
  <div class="main-content">
    <!-- Left Panel: Job List -->
    <aside class="left-panel">
      <!-- Summary Metrics -->
      <div class="summary-bar">
        @for (metric of summaryMetrics(); track metric.label) {
          <div class="summary-metric">
            <div class="metric-label">{{ metric.label }}</div>
            <div class="metric-value" [style.color]="metric.color">
              {{ metric.value }}
            </div>
          </div>
        }
      </div>

      <!-- Filters -->
      <div class="filters-bar">
        @for (filter of statusFilters; track filter.key) {
          <ui-filter-chip
            [active]="filterStatus() === filter.key"
            (clicked)="setStatusFilter(filter.key)"
          >
            {{ filter.label }}
          </ui-filter-chip>
        }
        <div class="filter-divider"></div>
        @for (filter of formatFilters; track filter.key) {
          <ui-filter-chip
            [active]="filterFormat() === filter.key"
            (clicked)="toggleFormatFilter(filter.key)"
          >
            <span [style.color]="filterFormat() === filter.key ? 'var(' + filter.cssVar + ')' : null">
              {{ filter.label }}
            </span>
          </ui-filter-chip>
        }
      </div>

      <!-- Job List -->
      <div class="job-list">
        @for (job of filteredJobs(); track job.id; let i = $index) {
          <div class="job-item" [style.animation-delay]="i * 0.04 + 's'">
            <app-job-card
              [job]="job"
              [selected]="selectedJobId() === job.id"
              (cardClicked)="selectJob(job.id!)"
            />
          </div>
        } @empty {
          <div class="empty-list">
            No jobs match
          </div>
        }
      </div>
    </aside>

    <!-- Center Panel: Job Detail or Schedule View -->
    <main class="center-panel">
      @if (viewMode() === 'jobs') {
        <app-job-detail
          [job]="selectedJob()"
          (download)="onDownload()"
          (retry)="onRetry()"
          (configure)="onConfigure()"
        />
      } @else {
        <app-schedule-view [jobs]="allJobs()" />
      }
    </main>

    <!-- Right Panel: Format Stats & Recent Activity -->
    <aside class="right-panel">
      <app-format-stats [jobs]="allJobs()" />
      <app-recent-activity [jobs]="allJobs()" />
    </aside>
  </div>
</div>
