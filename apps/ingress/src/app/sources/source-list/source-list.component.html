<mat-card>
  <mat-card-content>
    <mat-card-title>
      Data Sources
    </mat-card-title>

    <div class="flex gap-2 mb-4 px-2">
      @for (entry of statusCounts | keyvalue; track entry.key) {
        <span class="inline-flex items-center px-2 py-1 text-xs rounded-full"
          [class.bg-green-100]="entry.key === 'connected'"
          [class.text-green-800]="entry.key === 'connected'"
          [class.bg-red-100]="entry.key === 'error'"
          [class.text-red-800]="entry.key === 'error'"
          [class.bg-yellow-100]="entry.key === 'syncing' || entry.key === 'testing'"
          [class.text-yellow-800]="entry.key === 'syncing' || entry.key === 'testing'"
          [class.bg-gray-100]="entry.key === 'disconnected'"
          [class.text-gray-800]="entry.key === 'disconnected'">
          {{ entry.key }}: {{ entry.value }}
        </span>
      }
    </div>

    <mat-list>
      @for (source of sources; track source) {
        <mat-list-item class="mat-list-option" (click)="selected.emit(source)">
          <mat-icon matListItemIcon [color]="getStatusColor(source.status)">
            {{ getStatusIcon(source.status) }}
          </mat-icon>
          <span matLine class="font-medium">{{ source.name }}</span>
          <span matLine class="text-sm text-gray-500">{{ source.type }} &middot; {{ source.syncFrequency }}</span>
          <div matListItemMeta class="flex gap-1">
            <button mat-icon-button
              (click)="testConnection.emit(source.id!); $event.stopImmediatePropagation()"
              type="button"
              matTooltip="Test Connection">
              <mat-icon>wifi_tethering</mat-icon>
            </button>
            <button mat-icon-button
              (click)="syncSource.emit(source.id!); $event.stopImmediatePropagation()"
              type="button"
              matTooltip="Sync Now"
              [disabled]="source.status === 'syncing' || source.status === 'testing'">
              <mat-icon>sync</mat-icon>
            </button>
            <button mat-icon-button
              (click)="deleted.emit(source); $event.stopImmediatePropagation()"
              type="button" color="warn">
              <mat-icon>clear</mat-icon>
            </button>
          </div>
        </mat-list-item>
      }
    </mat-list>
  </mat-card-content>
</mat-card>
